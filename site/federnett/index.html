<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Federnett</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;600&family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./app.css" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <img
            class="brand-logo"
            src="/api/raw?path=src/federnett/logo.png"
            alt="Federnett logo"
          />
          <span class="brand-dot" aria-hidden="true"></span>
          <div class="brand-text">
            <strong>Federnett</strong>
            <span>Feather + Federlicht Studio</span>
          </div>
        </div>
        <div class="top-actions">
          <button id="reload-runs" class="ghost">Reload Runs</button>
          <button id="ask-button" class="ghost">질문하기</button>
          <button id="workspace-open-templates" class="ghost">Templates</button>
          <button id="workspace-open-agents" class="ghost">Agent Profiles</button>
          <button id="help-button" class="ghost">Help</button>
          <label class="theme-select">
            <span>Theme</span>
            <select id="theme-select" aria-label="Theme">
              <option value="default">Default</option>
              <option value="sky">Sky</option>
              <option value="crimson">Crimson</option>
              <option value="sage">Sage</option>
              <option value="amber">Amber</option>
            </select>
          </label>
        </div>
      </header>

      <section class="ask-panel" id="ask-panel" aria-hidden="true">
        <div class="ask-panel-head">
          <div>
            <h2>Federnett Guide Agent</h2>
            <p>코드/문서 기반으로 사용법을 답변합니다.</p>
          </div>
          <div class="ask-panel-actions">
            <button type="button" id="ask-reset" class="ghost">Reset</button>
            <button type="button" id="ask-close" class="ghost">접기</button>
          </div>
        </div>
        <div class="ask-status" id="ask-status">Ready.</div>
        <div class="ask-action-row" id="ask-action-row" aria-live="polite"></div>
        <div class="ask-results">
          <article class="ask-answer-wrap">
            <h3>답변</h3>
            <div id="ask-answer" class="ask-answer"></div>
          </article>
          <aside class="ask-sources-wrap">
            <h3>근거 소스</h3>
            <div id="ask-sources" class="ask-sources"></div>
          </aside>
        </div>
        <div class="ask-form-row ask-form-dock">
          <label>
            <span>질문</span>
            <textarea
              id="ask-input"
              rows="2"
              placeholder="예: Feather에서 Agentic Search를 언제 켜야 하나요?"
            ></textarea>
          </label>
          <label class="ask-model-field">
            <span>Model (optional)</span>
            <input id="ask-model" list="model-options" placeholder="$OPENAI_MODEL" />
          </label>
          <button type="button" id="ask-run" class="primary ask-run">질문 실행</button>
        </div>
      </section>

      <main class="layout">
        <section class="panel control">
          <div class="hero-grid panel-head">
            <div class="hero-copy">
              <div class="hero-badge">Agentic Research Studio</div>
              <h1>Enlighten your Technology Insight.</h1>
              <p>
                Run Feather to collect evidence, then drive Federlicht to craft
                reports. Logs stream live and everything stays inside your repo
                root.
              </p>
              <div class="meta-strip" id="meta-strip"></div>
            </div>
            <div class="hero-cards">
              <div
                class="hero-card hero-accent clickable"
                id="hero-card-runs"
                data-action="runs"
              >
                <span>Discovered Runs</span>
                <strong id="run-count">0</strong>
                <small>One level deep across run roots</small>
              </div>
              <div
                class="hero-card clickable"
                id="hero-card-templates"
                data-action="templates"
              >
                <span>Templates</span>
                <strong id="template-count">0</strong>
                <small>Loaded from `src/federlicht/templates`</small>
              </div>
              <div
                class="hero-card clickable"
                id="hero-card-run-roots"
                data-action="run-roots"
              >
                <span>Run Folders</span>
                <strong id="run-roots-badge">-</strong>
                <small>Load an existing run folder</small>
              </div>
              <div class="hero-card hero-recent clickable" id="hero-card-recent" aria-live="polite">
                <div class="hero-card-head">
                  <span>Recent Jobs</span>
                </div>
                <small id="recent-jobs-subtitle">Select a run folder to view activity.</small>
                <div class="hero-recent-summary">
                  <strong id="recent-jobs-count">0</strong>
                  <span id="recent-jobs-last">No recent jobs.</span>
                </div>
                <div class="hero-recent-actions">
                  <button type="button" id="jobs-open" class="ghost mini">View jobs</button>
                </div>
              </div>
            </div>
          </div>

          <div class="tabs" role="tablist">
            <button
              class="tab active"
              data-tab="feather"
              role="tab"
              aria-selected="true"
            >
              Feather
            </button>
            <button class="tab" data-tab="federlicht" role="tab">
              Federlicht
            </button>
          </div>
          <div class="tab-guide" id="tab-guide" aria-live="polite">
            <strong>1단계 Feather</strong>
            <span>외부 자료 수집과 증거 아카이빙</span>
          </div>

          <section class="tab-panel active" id="tab-feather" role="tabpanel">
            <div class="tab-shell">
              <form id="feather-form" class="form-grid">
                <label>
                  <span>Run Name</span>
                  <input
                    id="feather-run-name"
                    name="run_name"
                    placeholder="20260127_new-run"
                    autocomplete="off"
                  />
                </label>

                <label class="wide">
                  <span>Output Folder</span>
                  <input
                    id="feather-output"
                    name="output"
                    placeholder="20260127_new-run"
                    required
                  />
                </label>

                <label class="wide">
                  <span>Instruction File</span>
                  <div class="combo">
                    <input
                      id="feather-input"
                      name="input"
                      placeholder="20260127_new-run/instruction/20260127_new-run.txt"
                    />
                    <button type="button" id="feather-pick-instruction" class="ghost">
                      Choose
                    </button>
                  </div>
                </label>

                <label class="wide">
                  <span>Instruction (editable)</span>
                  <textarea
                    id="feather-query"
                    name="query"
                    rows="4"
                    placeholder="Edit or draft the instruction content here. Save to a file or run as ad-hoc query."
                  ></textarea>
                </label>
                <div class="instruction-inline-actions wide">
                  <button type="button" id="feather-save-instruction" class="ghost">
                    Save Instruction
                  </button>
                  <button type="button" id="feather-saveas-instruction" class="ghost">
                    Save Instruction As
                  </button>
                </div>

                <div class="toggles wide">
                  <label class="toggle">
                    <input type="checkbox" id="feather-download-pdf" checked />
                    <span>Download PDFs</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-openalex" checked />
                    <span>OpenAlex</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-youtube" />
                    <span>YouTube</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-yt-transcript" />
                    <span>YT Transcript</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-update-run" checked />
                    <span>Reuse Run Folder</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-agentic-search" />
                    <span>Agentic Search</span>
                  </label>
                </div>

                <details class="wide advanced">
                  <summary>Advanced</summary>
                  <div class="advanced-grid">
                    <label>
                      <span>Language</span>
                      <select id="feather-lang">
                        <option value="en" selected>en</option>
                        <option value="ko">ko</option>
                        <option value="de">de</option>
                      </select>
                    </label>
                    <label>
                      <span>Days</span>
                      <input id="feather-days" type="number" min="1" value="365" />
                    </label>
                    <label>
                      <span>Max Results</span>
                      <input
                        id="feather-max-results"
                        type="number"
                        min="1"
                        value="8"
                      />
                    </label>
                    <label>
                      <span>YouTube Order</span>
                      <input id="feather-yt-order" placeholder="relevance" />
                    </label>
                    <label class="wide">
                      <span>Extra Args</span>
                      <input
                        id="feather-extra-args"
                        placeholder="--tavily-topic news --max-openalex-pdfs 12"
                      />
                    </label>
                    <label>
                      <span>Agentic Model</span>
                      <input
                        id="feather-model"
                        placeholder="$OPENAI_MODEL"
                        list="model-options"
                      />
                    </label>
                    <label>
                      <span>Agentic Max Iter</span>
                      <input id="feather-max-iter" type="number" min="1" value="3" />
                    </label>
                  </div>
                </details>

                <div class="actions wide">
                  <button type="submit" class="primary" id="feather-run">Run Feather</button>
                </div>
              </form>
            </div>
          </section>

          <section class="tab-panel" id="tab-federlicht" role="tabpanel">
            <div class="tab-shell">
              <form id="federlicht-form" class="form-grid">
                <label class="wide">
                  <span>Run Folder</span>
                  <div class="combo">
                    <select id="run-select" required></select>
                    <button type="button" id="run-open" class="ghost">
                      Open Run Folder
                    </button>
                  </div>
                </label>

                <label class="wide">
                  <span>Output Report</span>
                  <input
                    id="federlicht-output"
                    placeholder="20260127_new-run/report_full.html"
                    required
                  />
                  <small id="federlicht-output-hint" class="muted"
                    >동일 파일이 있으면 자동으로 <code>_1</code>, <code>_2</code>가 붙습니다.</small
                  >
                </label>

                <label>
                  <span>Template</span>
                  <select id="template-select"></select>
                </label>

                <label>
                  <span>Language</span>
                  <select id="federlicht-lang">
                    <option value="ko" selected>ko</option>
                    <option value="en">en</option>
                    <option value="de">de</option>
                  </select>
                </label>

                <label>
                  <span>Depth</span>
                  <select id="federlicht-depth">
                    <option value="brief">brief</option>
                    <option value="standard" selected>standard</option>
                    <option value="deep">deep</option>
                    <option value="extreme">extreme</option>
                  </select>
                </label>

                <label>
                  <span>Model</span>
                  <input id="federlicht-model" placeholder="$OPENAI_MODEL" list="model-options" />
                </label>
                <label>
                  <span>Agent Profile</span>
                  <select id="federlicht-agent-profile"></select>
                </label>

                <label class="wide">
                  <span>Prompt File</span>
                  <div class="combo">
                    <input
                      id="federlicht-prompt-file"
                      placeholder="20260127_new-run/instruction/generated_prompt_20260127_new-run.txt"
                    />
                    <div class="combo-actions">
                      <button type="button" id="federlicht-prompt-pick" class="ghost">
                        Choose
                      </button>
                      <button type="button" id="federlicht-prompt-generate" class="ghost">
                        Generate
                      </button>
                    </div>
                  </div>
                </label>

                <label class="wide">
                  <span>Inline Prompt</span>
                  <textarea
                    id="federlicht-prompt"
                    rows="4"
                    placeholder="Optional: override or extend the prompt."
                  ></textarea>
                </label>
                <div class="instruction-inline-actions wide">
                  <button type="button" id="federlicht-save-prompt" class="ghost">
                    Save Prompt
                  </button>
                  <button type="button" id="federlicht-prompt-expand" class="ghost">
                    Expand Prompt
                  </button>
                  <button type="button" id="federlicht-saveas-prompt" class="ghost">
                    Save Prompt As
                  </button>
                </div>

                <div class="toggles wide">
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-figures" checked />
                    <span>Figures</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-web-search" />
                    <span>Web Search</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-free-format" />
                    <span>Free Format <span class="muted">(No Template)</span></span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-no-tags" />
                    <span>No Tags <span class="muted">(default off)</span></span>
                  </label>
                </div>

                <details class="wide advanced">
                  <summary>Advanced</summary>
                  <div class="advanced-grid">
                    <label>
                      <span>Check Model</span>
                      <input id="federlicht-check-model" placeholder="gpt-4o" list="model-options" />
                    </label>
                    <label>
                      <span>Vision Model</span>
                      <input id="federlicht-model-vision" placeholder="gpt-4o" list="model-options" />
                    </label>
                    <label>
                      <span>Template Rigidity</span>
                      <select id="federlicht-template-rigidity">
                        <option value="strict">strict</option>
                        <option value="balanced" selected>balanced</option>
                        <option value="relaxed">relaxed</option>
                        <option value="loose">loose</option>
                        <option value="off">off</option>
                      </select>
                    </label>
                    <label>
                      <span>Temperature Level</span>
                      <select id="federlicht-temperature-level">
                        <option value="very_low">very_low (0.0)</option>
                        <option value="low">low (0.1)</option>
                        <option value="balanced" selected>balanced (0.2)</option>
                        <option value="high">high (0.4)</option>
                        <option value="very_high">very_high (0.7)</option>
                      </select>
                    </label>
                    <label>
                      <span>Stages</span>
                      <input id="federlicht-stages" placeholder="scout,evidence,writer" />
                    </label>
                    <label>
                      <span>Skip Stages</span>
                      <input id="federlicht-skip-stages" placeholder="quality" />
                    </label>
                    <input id="federlicht-quality-iterations" type="hidden" value="1" />
                    <label>
                      <span>Quality Strategy</span>
                      <input id="federlicht-quality-strategy" value="pairwise" />
                    </label>
                    <label>
                      <span>Max Chars</span>
                      <input id="federlicht-max-chars" type="number" min="1000" />
                    </label>
                    <label>
                      <span>Max Tool Chars</span>
                      <input
                        id="federlicht-max-tool-chars"
                        type="number"
                        min="0"
                        placeholder="0 (auto)"
                      />
                    </label>
                    <label>
                      <span>Progress Chars</span>
                      <input
                        id="federlicht-progress-chars"
                        type="number"
                        min="100"
                        placeholder="800"
                      />
                    </label>
                    <label>
                      <span>Max PDF Pages</span>
                      <input id="federlicht-max-pdf-pages" type="number" min="0" />
                    </label>
                    <label>
                      <span>Figures Mode</span>
                      <input id="federlicht-figures-mode" value="auto" />
                    </label>
                    <label>
                      <span>Figures Select</span>
                      <input
                        id="federlicht-figures-select"
                        placeholder="report_notes/figures_selected.txt"
                      />
                    </label>
                    <label class="wide">
                      <span>Tags</span>
                      <input id="federlicht-tags" placeholder="qc,oled,materials" />
                    </label>
                    <label class="wide">
                      <span>Site Output</span>
                      <input id="federlicht-site-output" placeholder="run/report_full.html" />
                    </label>
                    <label class="wide">
                      <span>Extra Args</span>
                      <input
                        id="federlicht-extra-args"
                        placeholder="--progress --stream --repair-debug"
                      />
                    </label>
                  </div>
                </details>

                <div class="actions wide">
                  <button type="submit" class="primary" id="federlicht-run">
                    Run Federlicht
                  </button>
                </div>
              </form>
            </div>
          </section>

          <section
            id="run-studio-wrap"
            class="panel studio studio-inline"
            aria-live="polite"
          >
            <div class="panel-head slim">
              <div>
                <h2>Run Studio</h2>
                <p id="studio-meta">
                  Pick a run to inspect evidence, review artifacts, and shape the pipeline.
                </p>
              </div>
              <div class="panel-pills">
                <span class="meta-pill" id="studio-run-rel">-</span>
                <span class="meta-pill" id="studio-updated">-</span>
              </div>
            </div>

            <div class="studio-grid">
              <section class="studio-card summary-card" id="run-files-card">
                <header>
                  <h3>Run Snapshot &amp; Files</h3>
                  <p>Coverage summary and quick file access for the selected run.</p>
                </header>
                <div class="summary-actions">
                  <button id="run-trash" class="danger" type="button" disabled>
                    Trash Run
                  </button>
                </div>
                <ul id="run-summary-lines" class="summary-lines"></ul>
                <div id="run-summary-links" class="summary-links"></div>
                <div id="run-summary-reports" class="summary-reports"></div>
                <div class="file-list" id="run-file-list"></div>
              </section>
            </div>
          </section>
        </section>
        <div
          id="layout-splitter"
          class="splitter"
          aria-hidden="true"
          title="Drag to resize logs"
        ></div>
        <section class="panel telemetry" id="logs-wrap">
          <div class="telemetry-grid">
            <section class="telemetry-block logs-block">
              <div class="panel-head slim">
                <div>
                  <h2>Live Logs</h2>
                  <p id="job-status">No active job.</p>
                </div>
                <div class="log-actions">
                  <button id="log-mode" class="ghost">MD 보기</button>
                  <button id="log-toggle" class="ghost">Hide Logs</button>
                  <button id="log-clear" class="ghost">Clear</button>
                  <button id="job-kill" class="danger" disabled>Stop</button>
                </div>
              </div>
              <div class="workflow-strip" id="workflow-strip">
                <div class="workflow-head">
                  <strong>Workflow Pipeline</strong>
                  <span id="workflow-status">Idle</span>
                </div>
                <div class="workflow-track" id="workflow-track" aria-live="polite"></div>
                <div class="workflow-history-controls" id="workflow-history-controls">
                  <span id="workflow-history-hint" class="muted">History checkpoint: -</span>
                  <div class="workflow-history-actions">
                    <button
                      type="button"
                      id="workflow-resume-apply"
                      class="ghost"
                      title="선택한 단계부터 Stages/Skip 값을 자동으로 맞춰 재실행 프리셋을 만듭니다."
                      disabled
                    >
                      Resume from stage
                    </button>
                    <button
                      type="button"
                      id="workflow-resume-prompt"
                      class="ghost"
                      title="재실행용 update prompt 초안을 instruction 폴더에 생성합니다."
                      disabled
                    >
                      Draft update prompt
                    </button>
                  </div>
                </div>
                <div class="workflow-extras is-empty" id="workflow-extras" aria-live="polite"></div>
              </div>

              <div class="log-shell">
                <pre id="log-output" aria-live="polite"></pre>
                <div id="log-output-md" aria-live="polite"></div>
              </div>
            </section>

            <div
              id="telemetry-splitter"
              class="splitter-vertical"
              aria-hidden="true"
              title="Drag to resize logs"
            ></div>

            <section class="telemetry-block preview-block">
              <div class="panel-head slim">
                <div>
                  <h2>File Preview</h2>
                  <p>Preview reports, markdown, PDFs, or edit text files.</p>
                </div>
                <div class="file-preview-head">
                  <label class="file-preview-size">
                    <span>View</span>
                    <select id="file-preview-size">
                      <option value="compact">Compact</option>
                      <option value="fit" selected>Fit</option>
                      <option value="expanded">Expanded</option>
                    </select>
                  </label>
                  <span id="file-preview-path">No file selected</span>
                  <span id="file-preview-status" class="file-preview-status"></span>
                </div>
              </div>
              <div class="file-preview-body">
                <textarea
                  id="file-preview-editor"
                  class="file-preview-editor"
                  rows="10"
                  placeholder="Select a text file to preview."
                ></textarea>
                <div id="file-preview-markdown" class="file-preview-markdown"></div>
                <img id="file-preview-image" class="file-preview-image" alt="" />
                <iframe id="file-preview-frame" class="file-preview-frame" title="File preview"></iframe>
              </div>
              <input
                id="file-preview-saveas-path"
                class="ghost-input"
                placeholder="Save as path (e.g., report_notes/notes.md)"
              />
              <div class="file-preview-actions">
                <button type="button" id="file-preview-open" class="ghost">
                  Open
                </button>
                <button type="button" id="file-preview-canvas" class="ghost">
                  Canvas
                </button>
                <button type="button" id="file-preview-save" class="ghost">
                  Save
                </button>
                <button type="button" id="file-preview-saveas" class="ghost">
                  Save As
                </button>
              </div>
            </section>
          </div>
        </section>
      </main>

      <section class="workspace-panel" id="workspace-panel" aria-hidden="true">
        <div class="workspace-panel-head">
          <div>
            <h2>Federnett Workspace</h2>
            <p>Templates와 Agent Profiles를 한 패널에서 제어합니다.</p>
          </div>
          <div class="workspace-panel-actions">
            <button type="button" id="workspace-close" class="ghost">Close</button>
          </div>
        </div>
        <div class="workspace-tab-row" role="tablist" aria-label="Workspace tabs">
          <button
            type="button"
            class="workspace-tab active"
            id="workspace-tab-templates"
            data-workspace-tab="templates"
            aria-selected="true"
          >
            Templates
          </button>
          <button
            type="button"
            class="workspace-tab"
            id="workspace-tab-agents"
            data-workspace-tab="agents"
            aria-selected="false"
          >
            Agent Profiles
          </button>
        </div>
        <div class="workspace-pane active" id="workspace-pane-templates" data-workspace-pane="templates">
      <section class="panel templates-panel" id="templates-panel">
        <div class="panel-head slim">
          <div>
            <h2>Templates</h2>
            <p>Template sections + guidance parsed from frontmatter.</p>
          </div>
          <div class="panel-pills">
            <button type="button" class="ghost" id="templates-panel-toggle">Hide panel</button>
            <button type="button" class="ghost" id="templates-toggle">Hide cards</button>
          </div>
        </div>
        <div id="templates-grid" class="templates-grid"></div>
        <div class="template-editor" id="template-editor">
          <div class="template-editor-head">
            <div>
              <h3>Custom Template</h3>
              <p>Create or adjust a template, then save it under <code>src/federlicht/templates</code>.</p>
            </div>
            <div class="template-editor-actions">
              <button type="button" class="ghost" id="template-editor-load">Load Base</button>
              <button type="button" class="primary" id="template-editor-save">Save Template</button>
            </div>
          </div>
          <div class="template-editor-controls">
            <label>
              Base template
              <select id="template-editor-base"></select>
            </label>
            <label>
              Save as
              <input
                id="template-editor-name"
                class="ghost-input"
                placeholder="custom_my_template"
              />
            </label>
            <label>
              Save path
              <input
                id="template-editor-path"
                class="ghost-input"
                placeholder="site/custom_templates/custom_my_template.md"
                disabled
              />
            </label>
          </div>
          <div class="template-builder" id="template-builder">
            <div class="template-builder-row">
              <label>
                CSS style
                <select id="template-style-select"></select>
              </label>
              <div class="template-builder-actions">
                <button type="button" id="template-preview-refresh" class="ghost">Refresh Preview</button>
                <button type="button" id="template-apply-frontmatter" class="ghost">Apply to Editor</button>
              </div>
            </div>
            <div class="template-generator">
              <label>
                Generate base prompt
                <textarea
                  id="template-gen-prompt"
                  class="ghost-input"
                  placeholder="예: 월간 매거진 스타일의 기술동향 보고서 템플릿을 만들어줘..."
                ></textarea>
              </label>
              <div class="template-generator-row">
                <label>
                  Model
                  <input id="template-gen-model" list="model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label class="template-inline-check">
                  <input type="checkbox" id="template-store-site" />
                  Store in site (shared)
                </label>
                <button type="button" id="template-generate" class="primary">Generate Base</button>
              </div>
              <pre id="template-gen-log" class="template-gen-log">Ready.</pre>
            </div>
            <div class="template-builder-grid">
              <div class="template-sections-editor">
                <div class="template-section-head">
                  <h4>Sections</h4>
                  <button type="button" id="template-section-add" class="ghost">Add Section</button>
                </div>
                <div id="template-sections-list" class="template-sections-list"></div>
              </div>
              <div class="template-guidance-editor">
                <label>
                  Writer guidance (one per line)
                  <textarea
                    id="template-writer-guidance"
                    class="ghost-input template-writer-guidance"
                    placeholder="Use clear terminology and define acronyms."
                  ></textarea>
                </label>
              </div>
            </div>
            <div class="template-preview">
              <div class="template-preview-head">
                <h4>Preview</h4>
                <span class="muted">Uses the selected CSS and section order.</span>
              </div>
              <iframe id="template-preview-frame" class="template-preview-frame" title="Template preview"></iframe>
            </div>
          </div>
          <textarea
            id="template-editor-body"
            class="ghost-input template-editor-body"
            placeholder="Paste or edit template markdown here..."
          ></textarea>
          <div class="template-editor-meta" id="template-editor-meta"></div>
        </div>
      </section>
        </div>
        <div class="workspace-pane" id="workspace-pane-agents" data-workspace-pane="agents">
      <section class="panel agent-panel" id="agent-panel">
        <div class="panel-head slim">
          <div>
            <h2>Agent Profiles</h2>
            <p>Manage persona prompts, memory hooks, and profile-level Federlicht/agent overrides.</p>
          </div>
          <div class="panel-pills">
            <button type="button" class="ghost" id="agent-panel-toggle">Hide panel</button>
          </div>
        </div>
        <div class="agent-grid">
          <div class="agent-list">
            <div class="agent-list-head">
              <h3>Profiles</h3>
              <button type="button" id="agent-new" class="ghost">New</button>
            </div>
            <div id="agent-list" class="agent-list-items"></div>
          </div>
          <div class="agent-editor">
            <div class="agent-editor-head">
              <div>
                <h3 id="agent-editor-title">Profile</h3>
                <p id="agent-editor-meta" class="muted">Select a profile to edit.</p>
              </div>
              <div class="agent-editor-actions">
                <button type="button" id="agent-clone" class="ghost">Clone</button>
                <button type="button" id="agent-save" class="primary">Save</button>
                <button type="button" id="agent-delete" class="danger">Delete</button>
              </div>
            </div>
            <div id="agent-readonly-hint" class="agent-readonly-hint"></div>
            <div class="agent-editor-grid">
              <label>
                Profile ID
                <input id="agent-id" class="ghost-input" placeholder="federhav" />
              </label>
              <label>
                Agent name
                <input id="agent-name" class="ghost-input" placeholder="FederHav" />
              </label>
              <label>
                Author name
                <input id="agent-author-name" class="ghost-input" placeholder="Report byline author name" />
              </label>
              <label>
                Organization (optional)
                <input id="agent-organization" class="ghost-input" placeholder="Team or organization label" />
              </label>
              <label>
                Tagline
                <input
                  id="agent-tagline"
                  class="ghost-input"
                  placeholder="Havruta-inspired Knowledge Resonance AI"
                />
              </label>
              <label>
                Apply to
                <input
                  id="agent-apply-to"
                  class="ghost-input"
                  placeholder="writer,critic,reviser"
                />
              </label>
              <label>
                Memory description
                <input
                  id="agent-memory-desc"
                  class="ghost-input"
                  placeholder="Stable editorial values, interests, style preferences."
                />
              </label>
              <label>
                Memory file
                <input id="agent-memory-path" class="ghost-input" disabled />
              </label>
              <label class="agent-inline-check">
                <input type="checkbox" id="agent-store-site" />
                Store in site (shared)
              </label>
            </div>
            <label>
              System prompt
              <textarea
                id="agent-system-prompt"
                class="ghost-input"
                rows="6"
                placeholder="Describe the persona, tone, and constraints for this agent."
              ></textarea>
            </label>
            <label>
              Config overrides (JSON)
              <textarea
                id="agent-config-overrides"
                class="ghost-input"
                rows="6"
                placeholder='{"quality_iterations": 2, "quality_strategy": "pairwise", "template_rigidity": "balanced"}'
              ></textarea>
            </label>
            <label>
              Agent overrides (JSON)
              <textarea
                id="agent-agent-overrides"
                class="ghost-input"
                rows="8"
                placeholder='{"writer": {"model": "gpt-5.2"}, "critic": {"enabled": true}}'
              ></textarea>
            </label>
            <label>
              Memory hook
              <textarea
                id="agent-memory-text"
                class="ghost-input"
                rows="5"
                placeholder="Optional long-term notes, style rules, or domain anchors."
              ></textarea>
            </label>
            <pre id="agent-status" class="agent-status">Ready.</pre>
          </div>
        </div>
      </section>
        </div>
      </section>

      <div class="modal" id="instruction-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Instruction Files</h3>
              <p>Select an existing file or create a new one for Feather or Prompt.</p>
            </div>
            <button type="button" class="ghost" data-modal-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              id="instruction-search"
              class="ghost-input"
              placeholder="Filter by filename or path"
            />
            <label class="file-import">
              Import File
              <input id="instruction-import" type="file" accept=".txt,.md" />
            </label>
          </div>
          <div id="instruction-list" class="modal-list"></div>
          <div class="modal-footer">
            <input
              id="instruction-saveas"
              class="ghost-input"
              placeholder="instruction/new_topic.txt"
            />
            <div class="actions">
              <button type="button" id="instruction-use-selected" class="ghost">
                Use Selected
              </button>
              <button type="button" id="instruction-saveas-btn" class="primary">
                Save As
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="run-picker-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-runpicker-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Choose Run Folder</h3>
              <p>Select a run under the configured run root.</p>
            </div>
            <button type="button" class="ghost" data-runpicker-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              id="run-picker-search"
              class="ghost-input"
              placeholder="Filter runs"
            />
          </div>
          <div id="run-picker-list" class="modal-list"></div>
          <div class="modal-footer">
            <button type="button" id="run-picker-use" class="primary">Use Selected</button>
          </div>
        </div>
      </div>

      <div class="modal" id="jobs-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-jobs-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Recent Jobs</h3>
              <p id="jobs-modal-subtitle">Latest activity for the selected run.</p>
            </div>
            <div class="modal-controls">
              <button type="button" id="jobs-toggle" class="ghost">Show more</button>
              <button type="button" class="ghost" data-jobs-close>Close</button>
            </div>
          </header>
          <div id="jobs-modal-list" class="modal-list"></div>
        </div>
      </div>

      <div class="modal" id="template-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3 id="template-modal-title">Template Preview</h3>
              <p id="template-modal-meta">Template details</p>
            </div>
            <button type="button" class="ghost" data-modal-close>Close</button>
          </header>
          <div id="template-modal-body" class="modal-list"></div>
        </div>
      </div>

      <div class="modal" id="saveas-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-saveas-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Save As</h3>
              <p>Select a folder, then name the file.</p>
            </div>
            <button type="button" class="ghost" data-saveas-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              type="text"
              id="saveas-path"
              class="ghost-input"
              placeholder="Current folder"
            />
            <button type="button" class="ghost" id="saveas-up">Up</button>
          </div>
          <div id="saveas-list" class="modal-list"></div>
          <div class="modal-footer">
            <input
              type="text"
              id="saveas-filename"
              class="ghost-input"
              placeholder="Filename (e.g., notes.md)"
            />
            <button type="button" class="ghost" id="saveas-confirm">Save Here</button>
          </div>
        </div>
      </div>

      <div class="modal" id="help-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-help-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Federnett Help</h3>
              <p>Quick guidance for Feather, Federlicht, and pipeline controls.</p>
            </div>
            <button type="button" class="ghost" data-help-close>Close</button>
          </header>
          <div class="modal-list help-body">
            <section class="help-section" id="help-feather">
              <h4>Feather</h4>
              <ul>
                <li>
                  Choose an instruction file or edit inline, then Save / Save As before
                  running.
                </li>
                <li>
                  Output folder defaults to <code>&lt;run&gt;</code> under the configured
                  run root. Run name helps auto-fill paths.
                </li>
                <li>
                  Use Advanced for language, days, and max-results tweaks.
                </li>
                <li>
                  <code>--input</code>: instruction folder or single <code>.txt</code> file.
                </li>
                <li>
                  <code>--query</code>: inline instructions (separate with <code>;</code> or newlines).
                </li>
                <li>
                  <code>--output</code>: output archive root (defaults to run root if unset).
                </li>
                <li>
                  <code>--days</code>: lookback window in days (default: 30).
                </li>
                <li>
                  <code>--max-results</code>: results per search step (default: 8).
                </li>
                <li>
                  <code>--agentic-search</code>: turn on iterative LLM-guided expansion.
                </li>
                <li>
                  <code>--model</code>: model used for agentic planning turns.
                </li>
                <li>
                  <code>--max-iter</code>: maximum agentic planning iterations (default: 3).
                </li>
                <li>
                  <code>--download-pdf</code>: fetch arXiv PDFs + extract text.
                </li>
                <li>
                  <code>--update-run</code>: reuse an existing run folder instead of creating
                  a new <code>_01</code> suffix (UI default: on).
                </li>
                <li>
                  <code>--openalex</code>/<code>--no-openalex</code>: toggle OpenAlex OA search
                  (defaults on when <code>--download-pdf</code> is set).
                </li>
                <li>
                  <code>--youtube</code>/<code>--no-youtube</code>: toggle YouTube search
                  (default: off).
                </li>
                <li>
                  <code>--lang</code>: preferred language for search results (soft preference).
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-federlicht">
              <h4>Federlicht</h4>
              <ul>
                <li>
                  Pick a run folder, template, and prompt file. The inline prompt mirrors
                  the file for quick edits.
                </li>
                <li>
                  Save Prompt writes back to the selected file; Save Prompt As creates a
                  new file and updates the field.
                </li>
                <li>
                  Run is disabled while a job is active. Stop via Live Logs if needed.
                </li>
                <li>
                  Advanced toggles map to CLI flags (e.g., depth, web search, figures,
                  max input tokens). Use them to fine-tune report length and quality.
                </li>
                <li>
                  <code>--run</code>: run folder to synthesize.
                </li>
                <li>
                  <code>--output</code>: report output path (<code>.md</code>/<code>.html</code>/<code>.tex</code>).
                </li>
                <li>
                  <code>--template</code>: report template name/path (default: auto).
                </li>
                <li>
                  <code>--prompt</code>/<code>--prompt-file</code>: report focus prompt.
                </li>
                <li>
                  <code>--lang</code>: report language (default: ko).
                </li>
                <li>
                  <code>--depth</code>: brief | normal | deep | exhaustive (auto if unset).
                </li>
                <li>
                  <code>--template-rigidity</code>: strict | balanced | relaxed | loose | off (default: balanced).
                </li>
                <li>
                  <code>--temperature-level</code>: model creativity profile (default: balanced=0.2).
                </li>
                <li>
                  <code>--web-search</code>: enable web research (default: off).
                </li>
                <li>
                  <code>--stages</code>/<code>--skip-stages</code>: control pipeline stages.
                </li>
                <li>
                  <code>--max-input-tokens</code>: per-agent input budget (default: unset; uses model profile).
                </li>
                <li>
                  <code>--progress-chars</code>: live log snippet length before
                  <code>[truncated]</code> is appended (default: 800).
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-options">
              <h4>Options & Limits</h4>
              <ul>
                <li>
                  <code>max-chars</code> / <code>max-pdf-pages</code>: per-file read limits
                  for <code>read_document</code>.
                </li>
                <li>
                  <code>max-tool-chars</code>: cumulative cap for all <code>read_document</code>
                  outputs; overflow triggers reducer summaries.
                </li>
                <li>
                  PDF follow-ups can use <code>start_page</code> to read later pages without
                  raising global limits.
                </li>
                <li>
                  NEEDS_VERIFICATION items prefer tool-cache excerpts; ensure citations
                  point to verified chunks.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-pipeline">
              <h4>Workflow Pipeline</h4>
              <ul>
                <li>
                  Click stage chips in Live Logs to include/exclude stages, and drag to reorder.
                  Changes populate <code>Stages</code> and <code>Skip</code> automatically.
                </li>
                <li>
                  <code>Quality</code> stage controls whether quality agents run at all.
                  <code>xN</code> 배지를 클릭해 드롭다운에서 반복 횟수(1~10)를 선택할 수 있습니다.
                  Quality를 끄면 반복 루프도 함께 비활성화됩니다.
                </li>
                <li>
                  The <code>↺</code> marker beside Quality indicates feedback loop-back from
                  quality checks toward final writing passes.
                </li>
                <li>
                  <code>Resume from stage</code>는 History checkpoint를 기준으로 해당 단계부터
                  <code>Stages/Skip</code>를 자동 설정해 재실행 준비를 해줍니다.
                </li>
                <li>
                  이 Workflow는 멀티에이전트 오케스트레이션 뷰입니다. 각 stage는 역할별 agent 실행 단위를
                  의미하고, 순서/활성화를 통해 비용과 품질의 균형을 조절합니다.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-preview">
              <h4>File Preview</h4>
              <ul>
                <li>
                  Click a file in Run Studio to preview. Use Open to launch in a new tab,
                  Save / Save As for editable text.
                </li>
              </ul>
            </section>
          </div>
        </div>
      </div>

      <footer class="footnote">
        <div>Federnett orchestrates Feather and Federlicht CLIs via subprocess (non-invasive integration).</div>
        <div>Copyright (c) 2026 Hyun-Jung Kim. Federlicht Studio.</div>
      </footer>
    </div>

    <datalist id="model-options"></datalist>
    <script src="./app.js" type="module"></script>
  </body>
</html>
